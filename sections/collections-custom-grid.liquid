<collections-grid-component>
  <div id="section-{{ section.id }}" class="collections-grid-wrapper{% if section.settings.custom_class != blank %} {{ section.settings.custom_class }}{% endif %}">
  <div class="collections-grid-container">
    {% if section.blocks.size > 0 %}
      <div class="collections-grid">
        {% for block in section.blocks %}
          {% if block.type == 'collection_item' %}
            <div class="collections-grid__item" data-block-id="{{ block.id }}" ref="items[]" {{ block.shopify_attributes }}>
              {% if block.settings.collection_link != blank %}
                <a href="{{ block.settings.collection_link }}" class="collections-grid__link">
              {% endif %}

              <div class="collections-grid__image-wrapper">
                {% if block.settings.collection_image != blank %}
                  <img
                    src="{{ block.settings.collection_image | image_url: width: 1500 }}"
                    srcset="{{ block.settings.collection_image | image_url: width: 400 }} 400w,
                            {{ block.settings.collection_image | image_url: width: 800 }} 800w,
                            {{ block.settings.collection_image | image_url: width: 1200 }} 1200w,
                            {{ block.settings.collection_image | image_url: width: 1500 }} 1500w"
                    sizes="(min-width: 750px) 50vw, 100vw"
                    alt="{{ block.settings.collection_title | escape }}"
                    class="collections-grid__image"
                    loading="lazy"
                    width="{{ block.settings.collection_image.width }}"
                    height="{{ block.settings.collection_image.height }}"
                  >
                {% else %}
                  {{ 'collection-1' | placeholder_svg_tag: 'collections-grid__placeholder' }}
                {% endif %}

                {% if block.settings.show_overlay %}
                  <div class="collections-grid__overlay"></div>
                {% endif %}
              </div>

              {% if block.settings.collection_title != blank %}
                <div class="collections-grid__content">
                  <h2 class="collections-grid__title">{{ block.settings.collection_title }}</h2>
                  {% if block.settings.show_arrow %}
                    <div class="collections-grid__arrow">
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </div>
                  {% endif %}
                </div>
              {% endif %}

              {% if block.settings.collection_link != blank %}
                </a>
              {% endif %}
            </div>
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}
  </div>
  </div>
</collections-grid-component>

<script src="{{ 'collections-grid.js' | asset_url }}" type="module" defer></script>

<style>
  :root {
    --collections-grid-gap: 0px;
    --collections-grid-overlay-opacity: 0.2;
  }

  .collections-grid-wrapper {
    width: 100%;
    overflow: hidden;
  }

  .collections-grid-container {
    width: 100%;
    max-width: var(--collections-grid-max-width, 100%);
    margin: 0 auto;
  }

  .collections-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: var(--collections-grid-gap);
  }

  .collections-grid__item {
    position: relative;
    width: 100%;
    aspect-ratio: var(--collections-grid-aspect-ratio, 3/4);
    overflow: hidden;
    cursor: pointer;
  }

  .collections-grid__link {
    display: block;
    width: 100%;
    height: 100%;
    text-decoration: none;
    color: inherit;
  }

  .collections-grid__image-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
  }

  .collections-grid__image,
  .collections-grid__placeholder {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .collections-grid__overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--collections-grid-overlay-color, #000);
    opacity: var(--collections-grid-overlay-opacity);
    pointer-events: none;
    transition: opacity 0.3s ease;
  }

  .collections-grid__item:hover .collections-grid__overlay {
    opacity: var(--collections-grid-overlay-hover-opacity, 0.4);
  }

  .collections-grid__content {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: var(--collections-grid-content-padding, 30px);
    z-index: 2;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .collections-grid__title {
    font-weight: var(--collections-grid-title-weight, 700);
    line-height: 1.2;
    margin: 0;
    color: var(--collections-grid-title-color, #fff);
    text-transform: var(--collections-grid-title-transform, uppercase);
    letter-spacing: var(--collections-grid-title-spacing, 0.02em);
  }

  .collections-grid__arrow {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    color: var(--collections-grid-arrow-color, #fff);
    opacity: 0;
    transform: translateX(-10px);
    transition: opacity 0.3s ease, transform 0.3s ease;
  }

  .collections-grid__item:hover .collections-grid__arrow {
    opacity: 1;
    transform: translateX(0);
  }

  @media screen and (max-width: 749px) {
    .collections-grid {
      grid-template-columns: 1fr;
    }

    .collections-grid__title {
      font-size: var(--collections-grid-title-size-mobile, 32px);
    }

    .collections-grid__content {
      padding: var(--collections-grid-content-padding-mobile, 20px);
      /* Sticky title behavior - Mobile only */
      position: fixed;
      bottom: 40px;
      left: 0;
      right: 0;
      width: 100%;
      z-index: 10;
      will-change: transform, opacity;
      pointer-events: none;
    }

    .collections-grid__content * {
      pointer-events: auto;
    }

    .collections-grid__item {
      aspect-ratio: var(--collections-grid-aspect-ratio-mobile, 4/5);
    }
  }
</style>

<style>
  #section-{{ section.id }} {
    background-color: {{ section.settings.background_color }};
    padding-top: {{ section.settings.padding_top_mobile }}px;
    padding-bottom: {{ section.settings.padding_bottom_mobile }}px;
  }

  #section-{{ section.id }} .collections-grid-container {
    max-width: {{ section.settings.section_max_width }}px;
    padding-left: {{ section.settings.padding_horizontal_mobile }}px;
    padding-right: {{ section.settings.padding_horizontal_mobile }}px;
  }

  #section-{{ section.id }} .collections-grid {
    gap: {{ section.settings.grid_gap }}px;
  }

  #section-{{ section.id }} .collections-grid__item {
    aspect-ratio: {{ section.settings.aspect_ratio_desktop }};
  }

  #section-{{ section.id }} .collections-grid__overlay {
    background-color: {{ section.settings.overlay_color }};
    opacity: {{ section.settings.overlay_opacity | divided_by: 100.0 }};
  }

  #section-{{ section.id }} .collections-grid__item:hover .collections-grid__overlay {
    opacity: {{ section.settings.overlay_hover_opacity | divided_by: 100.0 }};
  }

  #section-{{ section.id }} .collections-grid__content {
    padding: {{ section.settings.content_padding_desktop }}px;
  }

  #section-{{ section.id }} .collections-grid__arrow {
    color: {{ section.settings.arrow_color }};
  }

  @media screen and (min-width: 750px) {
    #section-{{ section.id }} {
      padding-top: {{ section.settings.padding_top_desktop }}px;
      padding-bottom: {{ section.settings.padding_bottom_desktop }}px;
    }

    #section-{{ section.id }} .collections-grid-container {
      padding-left: {{ section.settings.padding_horizontal_desktop }}px;
      padding-right: {{ section.settings.padding_horizontal_desktop }}px;
    }

    #section-{{ section.id }} .collections-grid {
      grid-template-columns: repeat({{ section.settings.columns_desktop }}, 1fr);
    }
  }

  @media screen and (max-width: 749px) {
    #section-{{ section.id }} .collections-grid__item {
      {% if section.settings.aspect_ratio_mobile == 'screen' %}
        height: 100vh;
        height: 100svh;
        aspect-ratio: auto;
      {% else %}
        aspect-ratio: {{ section.settings.aspect_ratio_mobile }};
      {% endif %}
    }

    #section-{{ section.id }} .collections-grid__content {
      padding: {{ section.settings.content_padding_mobile }}px;
    }

    #section-{{ section.id }} .collections-grid {
      {% if section.settings.aspect_ratio_mobile == 'screen' %}
        grid-template-columns: 1fr;
      {% else %}
        grid-template-columns: repeat({{ section.settings.columns_mobile }}, 1fr);
      {% endif %}
    }
  }

  {% for block in section.blocks %}
    {% if block.type == 'collection_item' %}
      #section-{{ section.id }} .collections-grid__item[data-block-id="{{ block.id }}"] .collections-grid__title {
        font-size: {{ block.settings.title_size_desktop }}px;
        color: {{ block.settings.title_color }};
        font-weight: {{ block.settings.title_weight }};
        text-transform: {% if block.settings.title_uppercase %}uppercase{% else %}none{% endif %};
      }

      @media screen and (max-width: 749px) {
        #section-{{ section.id }} .collections-grid__item[data-block-id="{{ block.id }}"] .collections-grid__title {
          font-size: {{ block.settings.title_size_mobile }}px;
        }
      }
    {% endif %}
  {% endfor %}
</style>

{% schema %}
{
  "name": "Collections Grid",
  "class": "section-collections-grid",
  "settings": [
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "text",
      "id": "section_max_width",
      "label": "Section max width",
      "default": "1920",
      "info": "Maximum width in pixels"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#ffffff"
    },
    {
      "type": "text",
      "id": "custom_class",
      "label": "Custom CSS class",
      "info": "Add custom classes separated by spaces"
    },
    {
      "type": "header",
      "content": "Layout Settings"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 1,
      "max": 4,
      "step": 1,
      "default": 2,
      "label": "Columns (Desktop)"
    },
    {
      "type": "range",
      "id": "columns_mobile",
      "min": 1,
      "max": 3,
      "step": 1,
      "default": 1,
      "label": "Columns (Mobile)"
    },
    {
      "type": "range",
      "id": "grid_gap",
      "min": 0,
      "max": 100,
      "step": 2,
      "default": 0,
      "label": "Grid gap",
      "unit": "px"
    },
    {
      "type": "select",
      "id": "aspect_ratio_desktop",
      "label": "Aspect ratio (Desktop)",
      "options": [
        {
          "value": "1/1",
          "label": "Square (1:1)"
        },
        {
          "value": "3/4",
          "label": "Portrait (3:4)"
        },
        {
          "value": "4/5",
          "label": "Portrait (4:5)"
        },
        {
          "value": "2/3",
          "label": "Portrait (2:3)"
        },
        {
          "value": "16/9",
          "label": "Landscape (16:9)"
        },
        {
          "value": "4/3",
          "label": "Landscape (4:3)"
        }
      ],
      "default": "3/4"
    },
    {
      "type": "select",
      "id": "aspect_ratio_mobile",
      "label": "Aspect ratio (Mobile)",
      "options": [
        {
          "value": "1/1",
          "label": "Square (1:1)"
        },
        {
          "value": "3/4",
          "label": "Portrait (3:4)"
        },
        {
          "value": "4/5",
          "label": "Portrait (4:5)"
        },
        {
          "value": "2/3",
          "label": "Portrait (2:3)"
        },
        {
          "value": "16/9",
          "label": "Landscape (16:9)"
        },
        {
          "value": "4/3",
          "label": "Landscape (4:3)"
        },
        {
          "value": "4/9",
          "label": "Portrait (4:9)"
        },
        {
          "value": "screen",
          "label": "Screen Height"
        }
      ],
      "default": "4/5"
    },
    {
      "type": "header",
      "content": "Overlay Settings"
    },
    {
      "type": "color",
      "id": "overlay_color",
      "label": "Overlay color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 20,
      "label": "Overlay opacity",
      "unit": "%"
    },
    {
      "type": "range",
      "id": "overlay_hover_opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 40,
      "label": "Overlay hover opacity",
      "unit": "%"
    },
    {
      "type": "header",
      "content": "Arrow Settings"
    },
    {
      "type": "color",
      "id": "arrow_color",
      "label": "Arrow color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Spacing - Desktop"
    },
    {
      "type": "range",
      "id": "padding_top_desktop",
      "min": 0,
      "max": 200,
      "step": 4,
      "default": 60,
      "label": "Padding top",
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_bottom_desktop",
      "min": 0,
      "max": 200,
      "step": 4,
      "default": 60,
      "label": "Padding bottom",
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_horizontal_desktop",
      "min": 0,
      "max": 200,
      "step": 4,
      "default": 0,
      "label": "Padding horizontal",
      "unit": "px"
    },
    {
      "type": "range",
      "id": "content_padding_desktop",
      "min": 0,
      "max": 100,
      "step": 2,
      "default": 40,
      "label": "Content padding",
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Spacing - Mobile"
    },
    {
      "type": "range",
      "id": "grid_gap_mobile",
      "min": 0,
      "max": 100,
      "step": 2,
      "default": 4,
      "label": "Grid gap",
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_top_mobile",
      "min": 0,
      "max": 200,
      "step": 4,
      "default": 40,
      "label": "Padding top",
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_bottom_mobile",
      "min": 0,
      "max": 200,
      "step": 4,
      "default": 40,
      "label": "Padding bottom",
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_horizontal_mobile",
      "min": 0,
      "max": 100,
      "step": 2,
      "default": 0,
      "label": "Padding horizontal",
      "unit": "px"
    },
    {
      "type": "range",
      "id": "content_padding_mobile",
      "min": 0,
      "max": 100,
      "step": 2,
      "default": 24,
      "label": "Content padding",
      "unit": "px"
    }
  ],
  "blocks": [
    {
      "type": "collection_item",
      "name": "Collection Item",
      "settings": [
        {
          "type": "header",
          "content": "Image Settings"
        },
        {
          "type": "image_picker",
          "id": "collection_image",
          "label": "Collection image"
        },
        {
          "type": "url",
          "id": "collection_link",
          "label": "Collection link"
        },
        {
          "type": "checkbox",
          "id": "show_overlay",
          "label": "Show overlay",
          "default": true
        },
        {
          "type": "header",
          "content": "Title Settings"
        },
        {
          "type": "text",
          "id": "collection_title",
          "label": "Collection title",
          "default": "Collection"
        },
        {
          "type": "range",
          "id": "title_size_desktop",
          "min": 16,
          "max": 100,
          "step": 2,
          "default": 48,
          "label": "Title size (Desktop)",
          "unit": "px"
        },
        {
          "type": "range",
          "id": "title_size_mobile",
          "min": 16,
          "max": 80,
          "step": 2,
          "default": 32,
          "label": "Title size (Mobile)",
          "unit": "px"
        },
        {
          "type": "color",
          "id": "title_color",
          "label": "Title color",
          "default": "#ffffff"
        },
        {
          "type": "select",
          "id": "title_weight",
          "label": "Title weight",
          "options": [
            {
              "value": "400",
              "label": "Normal"
            },
            {
              "value": "500",
              "label": "Medium"
            },
            {
              "value": "600",
              "label": "Semi Bold"
            },
            {
              "value": "700",
              "label": "Bold"
            },
            {
              "value": "800",
              "label": "Extra Bold"
            }
          ],
          "default": "700"
        },
        {
          "type": "checkbox",
          "id": "title_uppercase",
          "label": "Uppercase title",
          "default": true
        },
        {
          "type": "header",
          "content": "Arrow Settings"
        },
        {
          "type": "checkbox",
          "id": "show_arrow",
          "label": "Show arrow on hover",
          "default": true
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Collections Grid",
      "blocks": [
        {
          "type": "collection_item",
          "settings": {
            "collection_title": "TEES"
          }
        },
        {
          "type": "collection_item",
          "settings": {
            "collection_title": "DENIMS"
          }
        }
      ]
    }
  ]
}
{% endschema %}
