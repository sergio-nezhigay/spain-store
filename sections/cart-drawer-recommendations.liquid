{% comment %}
  This section is used exclusively for rendering product recommendations
  in the cart drawer via the Section Rendering API.
  It is not meant to be added to pages directly.
{% endcomment %}

{% liquid
  # Determine which product to use for recommendations (first cart item)
  if cart.items.first
    assign recommendation_product = cart.items.first.product
  else
    assign recommendation_product = blank
  endif

  # Set display parameters
  assign max_products = 3
  assign mobile_columns = 2
  assign columns = 3
%}

<div class="cart-drawer-recommendations__content" data-debug-performed="{{ recommendations.performed }}" data-debug-count="{{ recommendations.products_count }}" data-debug-size="{{ recommendations.products.size }}">
  {%- if recommendations.performed -%}
    {% if recommendations.products_count > 0 %}
      <div class="cart-drawer-recommendations__grid">
        {% for product in recommendations.products limit: max_products %}
          <a href="{{ product.url }}" class="cart-drawer-recommendations__item">
            <div class="cart-drawer-recommendations__image">
              {% if product.featured_image %}
                {{ product.featured_image | image_url: width: 200 | image_tag: loading: 'lazy', alt: product.title }}
              {% else %}
                <div class="cart-drawer-recommendations__placeholder"></div>
              {% endif %}
            </div>
            <div class="cart-drawer-recommendations__details">
              <h4 class="cart-drawer-recommendations__title">{{ product.title }}</h4>
              <div class="cart-drawer-recommendations__price">
                {% if product.compare_at_price > product.price %}
                  <span class="cart-drawer-recommendations__sale-price">{{ product.price | money }}</span>
                  <span class="cart-drawer-recommendations__compare-price">{{ product.compare_at_price | money }}</span>
                {% else %}
                  <span>{{ product.price | money }}</span>
                {% endif %}
              </div>
            </div>
          </a>
        {% endfor %}
      </div>
    {% endif %}
  {%- else -%}
    {%- comment -%} Loading skeleton {%- endcomment -%}
    <div class="cart-drawer-recommendations__grid">
      {% for i in (1..3) %}
        <div class="cart-drawer-recommendations__skeleton-item"></div>
      {% endfor %}
    </div>
  {%- endif -%}
</div>

{% schema %}
{
  "name": "Cart Drawer Recommend..",
  "disabled_on": {
    "groups": ["header", "footer", "custom.overlay"]
  },
  "settings": []
}
{% endschema %}
